import{F as n,k as o,bH as z,aI as G,j as i,e as F,a as e,aj as c,I as f,at as J,au as K,av as W,bI as Y,S as Q,bJ as X,aG as Z}from"./index.d93c8983.js";import ee from"./UpdatePhoneModal.84030222.js";import te from"./UpdateEmailModal.d6d7a874.js";import{b as ae,e as se,f as ne}from"./myAccount.d903694d.js";import{R as N}from"./index.662772e9.js";import{E as k}from"./EditOutlined.60d0cc2d.js";const w={"update-btn":"_update-btn_iaqlz_1"},de=()=>{const[r]=n.useForm(),O={labelCol:{span:6},wrapperCol:{span:12}},M={required:"\u8BF7\u8F93\u5165${label}"},[l,S]=o.exports.useState({taskId:"",state:-1,processInstanceId:"",starter:"",comment:""}),[t,E]=o.exports.useState();o.exports.useEffect(()=>{(async()=>{const{data:a}=await ae(),{data:s}=await z({userId:a.accountNumber,key:"UPDATE_COMPANY_INFO"});if((!s||s.instanceInfo.state===3)&&(r.setFieldsValue(a),a.areaList&&r.setFieldValue("areaCode",a.areaList[0].code),E(a),x(`data:image/png;base64,${a.certificatePhoto}`)),s){const{state:u,processInstanceId:m,starter:p,comment:h}=s.instanceInfo;S({taskId:s.taskId,state:u,processInstanceId:m,starter:p,comment:h})}})()},[]);const[U,g]=o.exports.useState(!1),L=()=>{g(!0)},[v,B]=o.exports.useState(!1),q=()=>{B(!0)},[d,x]=o.exports.useState(""),_=a=>{new Promise(s=>{X(a.file,u=>{s(u)})}).then(s=>{const u=s.substring(s.indexOf("base64,")+7);x(s),r.setFieldValue("certificateFile",u)})},b=G(),j=()=>b(-1),T=async a=>{const{companyId:s,adminName:u,adminPhone:m,adminEmail:p}=t,{companyName:h,companyShortName:y,certificateNum:D,areaCode:P}=a,A=d.substring(d.indexOf("base64,")+7);let C="";if(l.state===3){const{taskId:I,processInstanceId:R,starter:$}=l,{retMessage:H}=await se({taskId:I,instanceId:R,starter:$,companyName:h,companyShortName:y,certificateNum:D,adminName:u,adminPhone:m,adminEmail:p,certificatePhoto:A,areaCode:P});C=H}else{const{retMessage:I}=await ne({companyId:s,companyName:h,companyShortName:y,adminName:u,adminPhone:m,adminEmail:p,certificateNum:D,certificatePhoto:A,areaCode:P});C=I}Z.success({content:C,duration:2,onClose(){b(-1)}})},V=a=>{console.log("Failed:",a)};return i(F,{children:[l.state===1?e(N,{title:"\u7533\u8BF7\u5BA1\u6838\u4E2D\uFF0C\u8BF7\u7A0D\u540E...",extra:e(c,{type:"primary",onClick:()=>b(-1),children:"\u8FD4\u56DE"},"console")}):i(F,{children:[l.state===3&&e(N,{title:`${l.comment}\uFF0C\u8BF7\u91CD\u65B0\u786E\u8BA4\u4FE1\u606F\uFF0C\u518D\u63D0\u4EA4\u7533\u8BF7`,status:"error"}),i(n,{form:r,name:"settings",...O,colon:!1,onFinish:T,onFinishFailed:V,validateMessages:M,autoComplete:"off",children:[e(n.Item,{label:"\u5355\u4F4D\u540D\u79F0",name:"companyName",rules:[{required:!0}],children:e(f,{showCount:!0,maxLength:20})}),e(n.Item,{name:"companyShortName",label:"\u5355\u4F4D\u7B80\u79F0",children:e(f,{showCount:!0,maxLength:10})}),e(n.Item,{name:"adminName",label:"\u5355\u4F4D\u7BA1\u7406\u5458\u59D3\u540D",rules:[{required:!0}],children:e(f,{showCount:!0,maxLength:20})}),e(n.Item,{label:"\u7BA1\u7406\u5458\u624B\u673A\u53F7",required:!0,children:i(F,{children:[t==null?void 0:t.adminPhone,e(c,{type:"text",className:w["update-btn"],icon:e(k,{}),onClick:L,children:"\u4FEE\u6539"})]})}),e(n.Item,{label:"\u7BA1\u7406\u5458\u90AE\u7BB1",required:!0,children:i(F,{children:[t==null?void 0:t.adminEmail,e(c,{type:"text",className:w["update-btn"],icon:e(k,{}),onClick:q,children:"\u4FEE\u6539"})]})}),e(n.Item,{name:"certificateNum",label:"\u7EDF\u4E00\u4FE1\u7528\u4EE3\u7801",children:e(f,{showCount:!0,maxLength:20})}),e(n.Item,{name:"certificateFile",label:"\u4FE1\u7528\u4EE3\u7801\u8BC1\u4E66",valuePropName:"certificateFile",children:e(J,{listType:"picture-card",maxCount:1,showUploadList:!1,beforeUpload:K,customRequest:_,children:d?e("img",{src:d,alt:"avatar",style:{maxWidth:"100%",maxHeight:"100%"}}):i("div",{children:[e(W,{}),e("div",{style:{marginTop:8},children:"\u9009\u62E9\u56FE\u7247"})]})})}),t&&e(n.Item,{name:"areaCode",label:"\u63A5\u5165\u5730\u533A",children:e(Y,{callback:a=>r.setFieldValue("areaCode",a),destinationList:t.areaList})}),e(n.Item,{wrapperCol:{offset:6,span:12},children:i(Q,{children:[e(c,{onClick:j,children:"\u8FD4\u56DE"}),e(c,{type:"primary",htmlType:"submit",children:"\u63D0\u4EA4\u7533\u8BF7"})]})})]})]}),(t==null?void 0:t.adminPhone)&&e(ee,{open:U,setOpen:g,companyInfo:t,callback:a=>E({...t,adminPhone:a})}),(t==null?void 0:t.adminEmail)&&e(te,{open:v,setOpen:B,companyInfo:t,callback:a=>E({...t,adminEmail:a})})]})};export{de as default};
//# sourceMappingURL=index.5176b8c6.js.map
